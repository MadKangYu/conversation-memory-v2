sequenceDiagram
    autonumber
    participant User as ğŸ‘¤ ì‚¬ìš©ì
    participant Orchestrator as ğŸ¼ ì˜¤ì¼€ìŠ¤íŠ¸ë¼<br/>(Claude Code)
    participant MCP as ğŸ”Œ MCP ì„œë²„
    participant IC as âš¡ InstantCompressor
    participant JE as ğŸ¥Š JabEngine
    participant OR as ğŸŒ OpenRouter
    participant DB as ğŸ’¾ SQLite

    Note over User,DB: Phase 1: InstantCompressor (LLM ì—†ìŒ)
    
    User->>Orchestrator: ëŒ€í™” ë©”ì‹œì§€ (10M í† í°)
    Orchestrator->>MCP: memory_add_message()
    MCP->>IC: compress(text)
    
    activate IC
    IC->>IC: 1. ì²­í‚¹ (500í† í° Ã— 20,000ê°œ)
    IC->>IC: 2. TF-IDF í‚¤ì›Œë“œ ì¶”ì¶œ
    IC->>IC: 3. TextRank ë¬¸ì¥ ì¶”ì¶œ
    IC->>IC: 4. SimHash ì¤‘ë³µ ì œê±°
    IC-->>MCP: ì••ì¶•ëœ ì²­í¬ (200ê°œ)
    deactivate IC
    
    Note over IC: ~500ms (LLM í˜¸ì¶œ ì—†ìŒ)
    
    MCP->>DB: ì²­í¬ ì €ì¥
    
    Note over User,DB: Phase 2: JabEngine (LLM ë³‘ë ¬ í˜¸ì¶œ)
    
    MCP->>JE: jabCompress(chunks)
    
    activate JE
    
    par ë³‘ë ¬ ìš”ì•½ (8 Workers)
        JE->>OR: Worker 1: ì²­í¬ 1-25
        JE->>OR: Worker 2: ì²­í¬ 26-50
        JE->>OR: Worker 3: ì²­í¬ 51-75
        JE->>OR: Worker 4: ì²­í¬ 76-100
        JE->>OR: Worker 5: ì²­í¬ 101-125
        JE->>OR: Worker 6: ì²­í¬ 126-150
        JE->>OR: Worker 7: ì²­í¬ 151-175
        JE->>OR: Worker 8: ì²­í¬ 176-200
    end
    
    Note over OR: Cerebras 70B: 100ms/ìš”ì²­
    
    OR-->>JE: ìš”ì•½ëœ ì²­í¬ (200ê°œ Ã— 150í† í°)
    
    JE->>JE: ê³„ì¸µì  ë³‘í•© (Level 1-3)
    JE-->>MCP: ìµœì¢… ì»¨í…ìŠ¤íŠ¸ (~8K í† í°)
    deactivate JE
    
    Note over JE: ~2.5ì´ˆ (ë³‘ë ¬ ì²˜ë¦¬)
    
    MCP->>DB: ì»¨í…ìŠ¤íŠ¸ ì €ì¥
    MCP-->>Orchestrator: ì••ì¶• ì™„ë£Œ
    Orchestrator-->>User: ì‘ë‹µ ìƒì„±
    
    Note over User,DB: ì´ ì²˜ë¦¬ ì‹œê°„: ~3ì´ˆ (10M í† í° â†’ 8K í† í°)
