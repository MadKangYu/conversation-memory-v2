# Conversation Memory V2 - 제품 요구사항 정의서 (PRD)

---

**문서 버전**: 1.0
**작성일**: 2026년 1월 9일
**작성자**: Manus AI

---

## 1. 개요 (Introduction)

**Conversation Memory V2**는 대규모 언어 모델(LLM) 기반 AI 에이전트의 장기 기억 능력 부재 문제를 해결하기 위한 차세대 메모리 관리 시스템입니다. 본 프로젝트는 사용자와 에이전트 간의 대화, 도구 사용 기록 등 모든 상호작용을 자동으로 캡처하고, 이를 지능적으로 압축하여 에이전트의 컨텍스트 한계를 극복하게 함으로써 진정한 의미의 연속성 있는 대화 경험을 제공하는 것을 목표로 합니다.

핵심 기술인 **팩토리 드루이드(Factory Druid) 패턴**을 통해, 사용자는 단 한 번의 설치만으로 Claude Code, OpenCode와 같은 다양한 AI 에이전트 환경에서 완전 자동화된 백그라운드 메모리 관리를 활성화할 수 있습니다.

## 2. 문제 정의 (Problem Statement)

현존하는 AI 에이전트는 주로 제한된 크기의 컨텍스트 윈도우(Context Window)에 의존하여 대화의 맥락을 파악합니다. 이로 인해 다음과 같은 근본적인 문제들이 발생합니다.

- **기억 상실 (Memory Loss)**: 대화가 길어지면 컨텍스트 윈도우의 용량을 초과하여 이전의 중요한 정보를 잊어버리게 됩니다. 이는 대화의 일관성을 해치고 작업의 연속성을 단절시킵니다.
- **수동적 컨텍스트 관리**: 사용자는 중요한 정보를 유지하기 위해 직접 컨텍스트를 요약하거나, 이전 대화 내용을 복사하여 붙여넣는 등 번거로운 수작업을 반복해야 합니다.
- **비용 증가**: 모든 대화 내용을 컨텍스트에 포함시키려는 시도는 API 호출 시 토큰 사용량을 급격히 증가시켜 불필요한 비용을 발생시킵니다.
- **플랫폼 종속성**: 각 AI 에이전트 플랫폼(Claude Code, OpenCode 등)은 서로 다른 아키텍처를 가지고 있어, 일관된 메모리 관리 솔루션을 구축하기 어렵습니다.

## 3. 비전 및 목표 (Vision & Goals)

### 3.1. 비전

> "AI 에이전트가 인간과 같이 자연스러운 장기 기억을 바탕으로, 모든 대화의 맥락을 이해하고 연속적인 작업을 수행할 수 있는 세상을 만든다."

### 3.2. 목표

- **완전 자동화 (Zero-Effort)**: 사용자의 개입 없이 모든 대화 내용을 자동으로 캡처, 압축, 주입하는 '설치하고 잊어버리는(Set-it-and-forget-it)' 경험을 제공합니다.
- **컨텍스트 효율 극대화**: `InstantCompressorV3` 압축 알고리즘을 통해 원본 대화의 핵심 정보를 보존하면서 토큰 사용량을 **최소 70% 이상** 절감합니다.
- **플랫폼 독립성**: **팩토리 드루이드 패턴**을 통해 Claude Code와 OpenCode 환경 모두에서 일관된 메모리 관리 기능을 제공합니다.
- **성능 최적화**: Hook 및 플러그인의 응답 시간을 **50ms 미만**으로 유지하여 에이전트의 상호작용 속도에 영향을 주지 않습니다.

## 4. 대상 고객 (Target Audience)

- **AI 파워 유저 (Power Users)**: 복잡하고 긴 호흡의 작업을 AI 에이전트와 함께 수행하며, 컨텍스트 관리의 한계를 자주 경험하는 고급 사용자.
- **AI 개발자 및 연구원 (Developers & Researchers)**: AI 에이전트의 장기 기억 능력을 연구하거나, 자신의 애플리케이션에 장기 기억을 통합하고자 하는 개발자.
- **프로덕션 환경 운영자**: LLM 기반 챗봇이나 서비스를 운영하며, 비용 효율적이고 일관된 사용자 경험을 제공해야 하는 기업 또는 개인.

## 5. 핵심 기능 (Core Features)

### 5.1. 자동 대화 캡처 (Automated Conversation Capture)

- **요구사항**: 사용자의 프롬프트, AI 에이전트의 응답, 도구(Tool/MCP) 호출 및 결과 등 세션 내에서 발생하는 모든 상호작용을 자동으로 캡처해야 합니다.
- **세부사항**:
  - Claude Code: `settings.json`의 Hook(UserPromptSubmit, PostToolUse, Stop 등)을 통해 모든 이벤트를 가로채어 캡처합니다.
  - OpenCode: 플러그인의 이벤트 핸들러(message.updated, tool.execute.after 등)를 통해 모든 상호작용을 캡처합니다.
  - 캡처된 데이터는 역할(user, assistant, tool), 내용, 타임스탬프를 포함하는 표준화된 형식으로 저장됩니다.

### 5.2. 백그라운드 압축 (Background Compression)

- **요구사항**: 캡처된 대화 내용은 AI 에이전트의 메인 스레드를 방해하지 않고 백그라운드에서 비동기적으로 압축되어야 합니다.
- **세부사항**:
  - **압축 엔진**: `InstantCompressorV3`를 사용하여 텍스트의 중복을 제거하고 핵심 정보를 추출합니다.
  - **Claude Code**: 별도의 **데몬(Daemon) 프로세스**가 큐(Queue)에 쌓인 대화 조각들을 지속적으로 처리하고 압축 결과를 파일로 저장합니다.
  - **OpenCode**: 플러그인 내에 내장된 **백그라운드 워커(Background Worker)**가 이벤트 루프를 통해 비동기적으로 압축을 수행합니다.

### 5.3. 자동 컨텍스트 주입 (Automatic Context Injection)

- **요구사항**: AI 에이전트가 컨텍스트를 압축하는 시점에, 백그라운드에서 생성된 압축 메모리를 자동으로 컨텍스트에 주입해야 합니다.
- **세부사항**:
  - **Claude Code**: `PreCompact` Hook이 트리거되면, 데몬이 미리 준비해 둔 압축 컨텍스트 파일을 읽어 stdout으로 출력하여 컨텍스트에 주입합니다.
  - **OpenCode**: `experimental.session.compacting` 이벤트가 발생하면, 워커가 보유한 압축 컨텍스트를 `output.context.push()` API를 통해 직접 주입합니다.
  - 주입되는 컨텍스트는 마크다운 형식으로 가공되어 가독성을 높입니다. (예: `## 압축된 대화 기록...`)

### 5.4. 통합 설치 프로그램 (Unified Installer)

- **요구사항**: 사용자는 단일 명령어를 통해 자신의 플랫폼에 맞는 메모리 관리 시스템을 손쉽게 설치할 수 있어야 합니다.
- **세부사항**:
  - `memory-factory install` 명령어를 제공합니다.
  - 스크립트는 실행 환경을 자동으로 감지하여 Claude Code 또는 OpenCode에 맞는 설정(Hook 또는 플러그인)을 자동으로 구성합니다.
  - `uninstall`, `status`와 같은 편의 명령어를 통해 설치 상태를 관리할 수 있습니다.

## 6. 기술 요구사항 (Technical Requirements)

| 항목 | 요구사항 |
| :--- | :--- |
| **지원 플랫폼** | - Claude Code (v2.5 이상) <br> - OpenCode (v1.8 이상) |
| **프로그래밍 언어** | TypeScript (Node.js v18 이상) |
| **데이터 저장소** | - **큐**: 파일 시스템 기반 임시 큐 (예: `/tmp/memory-factory-queue`) <br> - **영구 저장**: SQLite 또는 파일 기반 JSON (사용자 홈 디렉터리 내 `.memory-factory`) |
| **성능** | - **Hook/Plugin 응답 시간**: 50ms 미만 <br> - **메모리 점유율**: 데몬/워커 프로세스는 100MB 미만의 메모리 사용 |
| **배포** | npm 패키지로 배포 (`npx memory-factory install` 지원) |

## 7. 향후 계획 (Future Scope)

- **다중 에이전트 지원**: Replit, Cursor 등 더 많은 AI 에이전트 플랫폼 지원 확대.
- **시맨틱 메모리 검색**: 키워드 기반 검색을 넘어, 의미 기반으로 과거 대화 내용을 검색하고 관련 정보를 컨텍스트에 동적으로 주입하는 기능.
- **사용자 대시보드**: 웹 기반 대시보드를 통해 저장된 대화 기록을 확인, 검색, 관리하고 토큰 절감 효과를 시각적으로 분석하는 기능.
- **클라우드 동기화**: 여러 장치와 환경에서 일관된 장기 기억을 공유할 수 있도록 클라우드 백엔드와 동기화하는 기능.
